# Компиляторы и средства разработки (продолжение)

## Процессорные оптимизации

Если компилятору не сообщить информацию о расширенном наборе команд, то будет сделана сборка под набор инструкций 2000-го года (AMD64).

Пример: `g++ -march=skylake main.cc`

Плюсы: более быстрая производительность на выбранном процессоре
Минусы: исполняемый файл становится не переносимым ("не является исполняемым файлом")

## Автоматическая диспетчеризация

Приложение компилируется несколько раз:
1-й раз под AMD64 (запускается на любом процессоре)
2-й раз под ту систему команд, которую поддерживает процессор
(может быть и третий и другие сборки в рамках одного исполняемого файла)
Перед запуском самого приложения, выполняется код (собранный под AMD64), который опрашивает процессор и выбирает какой код запуска -- оптимизированный или максимально совместимый.

Плюсы: Решение проблемы переносимости из предыдущего раздела
Минусы: Больший вес исполняемого файла. Не имеет смысла не устройствах, где мы и так знаем целевую платформу.

При диспетчеризации всего файла, вероятность кэш-промохов не высока, т.к. работа идёт в рамках одного блока кода.
Кэш промахи могут происходить при диспетчеризации участков кода (к примеру, цикл).

Можно выполнять и ручную диспетчеризацию путём использования интрисиков.

## Точность вычислений вещественных чисел

Увеличение точности для чисел с плавающей точкой ведёт к увеличению времени выполнения.

`-Op`, `-Za` (`-mp`, `-ansi` на Linux) строгое следование стандарту (IEEE 754). Если процессор не умеет следовать стандарту аппаратными средствами, это делается программно.
`-Qlong_double` (не доступен в Linux) обычно процессор работает с 80-битными операндами, а потом усекает их то требуемого формата (одинарная точно, двойная, четырёхкратная). Эта опция делает так, чтоб переменные помнили свои хвосты. К примеру, long double увеличивается с 64 до 80 бит. Поддерживается начиная с EM64T.
`-Qprec_div` (`-prec_div` Linux) (IA-32) операции деления заменяет на обратные операции умножения (снижается точность, повышается скорость). Поддерживается EM64T.
`-Qpc{32|64|80}` (IA-32) Указывает требуемое количество битов для всех переменных.

Современные IDE позволяют выставить флаги компиляции/оптимизации для каждого файла.

> При использовании IDE, сборка проекта не должна зависеть от IDE

## Математические библиотеки

LIBM более высокая скорость операций на архитектурах от Intel
Подменяет стандартные функции в libc от Microsoft.

## Итого:

Стандартные типы оптимизации:
- процессорные
- точность вычисления
- специальные библиотеки
- диспетчеризация

Отключение оптимизации может потребоваться, к примеру, для отладки.
